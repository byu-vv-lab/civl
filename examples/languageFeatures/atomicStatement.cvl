int n = 3;

void main(){
	int x = 3;
	
	// non-determinism allowed in $atomic block
	$atomic{
		$choose {
			$when (n>2) { x=2;  }
			$when (n>1) { x=1;  }
			default: {x=0;  }
		}
	}
	
	$assert (x == 2 || x == 1);
}
